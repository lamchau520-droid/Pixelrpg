<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monster World Ultimate</title>
<style>
body{margin:0;background:#1b1b1b;color:white;font-family:sans-serif;text-align:center}
canvas{background:#3cb371;display:block;margin:auto;border:3px solid white}
button{padding:6px;margin:3px;font-size:13px}
.hpbar{height:10px;background:red;margin:4px 0}
.battleBox{background:#111;border:3px solid white;margin:8px;padding:8px}
.ctrl{position:fixed;bottom:10px;left:50%;transform:translateX(-50%)}
.ctrl button{width:50px;height:50px;font-size:18px}
</style>
</head>
<body>

<h2>üåç Monster World Ultimate</h2>
<canvas id="game" width="420" height="420"></canvas>
<div id="ui"></div>

<div class="ctrl">
<button onclick="move(0,-10)">‚¨ÜÔ∏è</button><br>
<button onclick="move(-10,0)">‚¨ÖÔ∏è</button>
<button onclick="move(10,0)">‚û°Ô∏è</button><br>
<button onclick="move(0,10)">‚¨áÔ∏è</button>
</div>

<script>
let save=JSON.parse(localStorage.getItem("save"))||{};
let player={x:200,y:200,size:20,gold:save.gold||100,wins:save.wins||0,caught:save.caught||0};
let inventory={balls:save.balls||5};
let playerTeam=save.team||[];
let inBattle=false;
let activeMonster,wildMonster;

const monsters=[
 {name:"Flamio",hp:30,maxHp:30,atk:6,type:"fire"},
 {name:"Leafy",hp:28,maxHp:28,atk:5,type:"grass"},
 {name:"Aquos",hp:32,maxHp:32,atk:4,type:"water"}
];

const boss={name:"Drakor ‚≠ê",hp:90,maxHp:90,atk:15,type:"dark",boss:true};
const mythic={name:"Zenthor üåå",hp:140,maxHp:140,atk:22,type:"dark",boss:true,mythic:true};

function saveGame(){
 localStorage.setItem("save",JSON.stringify({
  gold:player.gold,balls:inventory.balls,team:playerTeam,wins:player.wins,caught:player.caught
 }));
}

function draw(){
 const ctx=game.getContext("2d");
 ctx.fillStyle="#3cb371";ctx.fillRect(0,0,420,420);
 ctx.fillStyle="yellow";ctx.fillRect(player.x,player.y,player.size,player.size);
 if(playerTeam.length>0){ctx.fillStyle="white";ctx.fillRect(player.x-25,player.y,15,15);}
}

function randomMonster(){return JSON.parse(JSON.stringify(monsters[Math.floor(Math.random()*monsters.length)]));}

function startBattle(mon){
 inBattle=true;
 wildMonster=JSON.parse(JSON.stringify(mon));
 activeMonster=playerTeam[0]||randomMonster();
 showBattleUI();
}

function hpBar(c,m){return `<div class="hpbar" style="width:${(c/m)*100}%"></div>`;}

function showBattleUI(){
 ui.innerHTML=`
 <div class="battleBox">
 <h3>${activeMonster.name} vs ${wildMonster.name}</h3>
 B·∫°n ${activeMonster.hp}/${activeMonster.maxHp}${hpBar(activeMonster.hp,activeMonster.maxHp)}
 ƒê·ªãch ${wildMonster.hp}/${wildMonster.maxHp}${hpBar(wildMonster.hp,wildMonster.maxHp)}
 <button onclick="attack()">ƒê√°nh</button>
 <button onclick="skill()">Skill</button>
 <button onclick="catchMonster()">B·∫Øt (${inventory.balls})</button>
 </div>`;
}

function attack(){wildMonster.hp-=activeMonster.atk;if(wildMonster.hp<=0){win(false);return;}enemyTurn();}
function skill(){wildMonster.hp-=activeMonster.atk*2;if(wildMonster.hp<=0){win(false);return;}enemyTurn();}
function enemyTurn(){activeMonster.hp-=wildMonster.atk;if(activeMonster.hp<=0){endBattle();return;}showBattleUI();}

function catchMonster(){
 if(inventory.balls<=0)return;
 inventory.balls--;
 let chance=wildMonster.mythic?0.03:wildMonster.boss?0.08:0.4;
 if(Math.random()<chance){
   playerTeam.push(wildMonster);
   player.caught++;
   win(true);
 }else showBattleUI();
}

function win(catchWin){
 player.gold+=50;
 player.wins++;
 checkQuest();
 endBattle();
}

function checkQuest(){
 if(player.caught>=3){player.gold+=100;alert("Ho√†n th√†nh nhi·ªám v·ª• b·∫Øt qu√°i!");player.caught=0;}
 if(player.wins>=5){inventory.balls+=3;alert("Ho√†n th√†nh nhi·ªám v·ª• th·∫Øng tr·∫≠n!");player.wins=0;}
}

function endBattle(){inBattle=false;saveGame();updateUI();}

function openHome(){
 ui.innerHTML=`<h3>üè† Nh√† Nu√¥i Qu√°i</h3>
 ${playerTeam.map((m,i)=>`<div>${m.name} HP:${m.hp}/${m.maxHp}
 <button onclick="heal(${i})">H·ªìi m√°u</button>
 <button onclick="setMain(${i})">Ch·ªçn</button></div>`).join("")}
 <button onclick="updateUI()">Tho√°t</button>`;
}

function heal(i){playerTeam[i].hp=playerTeam[i].maxHp;openHome();}
function setMain(i){let m=playerTeam.splice(i,1)[0];playerTeam.unshift(m);openHome();}

function updateUI(){
 ui.innerHTML=`ü™ô${player.gold} | üî¥${inventory.balls}
 <br>ƒê·ªôi: ${(playerTeam.map(m=>m.name).join(", ")||"Ch∆∞a c√≥")}
 <br><button onclick="openHome()">Nh√† qu√°i</button>`;
}

function move(dx,dy){
 if(inBattle)return;
 player.x+=dx;player.y+=dy;
 if(Math.random()<0.02)startBattle(randomMonster());
 if(Math.random()<0.005)startBattle(boss);
 if(Math.random()<0.002)startBattle(mythic);
}

document.addEventListener("keydown",e=>{
 if(e.key=="ArrowUp")move(0,-10);
 if(e.key=="ArrowDown")move(0,10);
 if(e.key=="ArrowLeft")move(-10,0);
 if(e.key=="ArrowRight")move(10,0);
});

function loop(){draw();requestAnimationFrame(loop);}
updateUI();
loop();
</script>
</body>
</html>
